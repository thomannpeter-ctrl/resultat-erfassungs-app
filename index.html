<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Resultate erfassen</title>
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<style>
body{margin:0;font-family:system-ui;background:#0b0f17;color:#e8eefc}
header{position:sticky;top:0;background:#0b0f17cc;border-bottom:1px solid #222;z-index:5}
.wrap{max-width:1200px;margin:auto;padding:16px}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.spacer{flex:1}
button,select,input{background:#151c2e;border:1px solid #2a3555;color:#e8eefc;border-radius:10px;padding:10px 12px}
button.primary{background:#2b4c8a}
button.secondary{background:#1f2a44}
button.danger{background:#5a2222}
.card{background:#121a2a;border:1px solid #243055;border-radius:16px;margin-bottom:16px}
.head{padding:12px;border-bottom:1px solid #243055;font-weight:600}
.body{padding:12px}
h3{margin:14px 0 6px;color:#9fb0e0}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{padding:8px;border-bottom:1px solid #243055;text-align:left}
th{color:#9fb0e0;font-size:11px;text-transform:uppercase}
.modalBack{position:fixed;inset:0;background:#0008;display:none;align-items:center;justify-content:center}
.modal{background:#121a2a;border-radius:16px;border:1px solid #243055;width:520px}
.field{margin-bottom:10px}
label{font-size:12px;color:#9fb0e0;display:block;margin-bottom:4px}
.actions{display:flex;gap:12px;margin-top:16px}
.actions button{flex:1}
</style>
</head>

<body>

<script>
/* üîî STARTWARNUNG */
if (!localStorage.getItem("exportStartWarningShown")) {
  alert("‚ö†Ô∏è WICHTIG:\n\nVor dem L√∂schen der Browserdaten unbedingt Export machen!");
  localStorage.setItem("exportStartWarningShown","1");
}
</script>

<header>
  <div class="wrap row">
    <strong>Resultate erfassen</strong>
    <div class="spacer"></div>
    <select id="yearSelect"></select>
    <button onclick="openModal()">+ Resultat</button>
  </div>
</header>

<main class="wrap">
  <div class="card"><div class="head">Dashboard ‚Äì aktuelles Jahr</div><div class="body" id="dashYear"></div></div>
  <div class="card"><div class="head">Langzeit√ºbersicht</div><div class="body" id="dashAll"></div></div>
  <div class="card"><div class="head">Eintr√§ge</div><div class="body" id="entries"></div></div>
</main>

<div class="modalBack" id="modal">
  <div class="modal">
    <div class="head">Neues Resultat</div>
    <div class="body">
      <div class="field"><label>Jahr</label><select id="mYear"></select></div>
      <div class="field"><label>Disziplin</label>
        <select id="mDiscipline">
          <option value="">‚Äì w√§hlen ‚Äì</option>
          <option>300m</option><option>50m</option><option>10m</option>
        </select>
      </div>
      <div class="field"><label>Art</label>
        <select id="mType"><option>Wettkampf</option><option>Training</option></select>
      </div>
      <div class="field"><label>Wettkampf</label><input id="mEventNew"></div>
      <div class="field"><label>Resultat</label><input id="mRes" type="number"></div>
      <div class="actions">
        <button onclick="save()">Speichern</button>
        <button onclick="closeModal()">Abbrechen</button>
      </div>
    </div>
  </div>
</div>

<script>
const START=2010, NOW=new Date().getFullYear();
let state=JSON.parse(localStorage.getItem("resultateState"))||{
  years:[...Array(NOW-START+1)].map((_,i)=>START+i),
  entries:[]
};
let selectedYear=NOW;

function persist(){localStorage.setItem("resultateState",JSON.stringify(state));}

function render(){
  yearSelect.innerHTML=state.years.map(y=>`<option ${y===selectedYear?"selected":""}>${y}</option>`).join("");
  mYear.innerHTML=yearSelect.innerHTML;

  dashYear.innerHTML=buildTable(state.entries.filter(e=>e.year===selectedYear));
  dashAll.innerHTML=buildTable(state.entries);
  renderEntries();
}

function buildTable(arr){
  if(!arr.length) return "‚Äì keine Eintr√§ge ‚Äì";
  return `<table><tr><th>Jahr</th><th>Disziplin</th><th>Resultat</th></tr>`+
    arr.map(e=>`<tr><td>${e.year}</td><td>${e.discipline}</td><td>${e.res}</td></tr>`).join("")+
    `</table>`;
}

function renderEntries(){
  entries.innerHTML=buildTable(state.entries);
}

function openModal(){modal.style.display="flex";}
function closeModal(){modal.style.display="none";}

function save(){
  state.entries.push({
    year:+mYear.value,
    discipline:mDiscipline.value,
    type:mType.value,
    event:mEventNew.value,
    res:+mRes.value
  });
  persist();
  closeModal();
  render();
}

yearSelect.onchange=e=>{selectedYear=+e.target.value;render();};
render();
</script>

</body>
</html>
